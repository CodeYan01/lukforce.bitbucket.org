<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<title>Internal OPTC Calendar</title>

<link href="assets/css/fullcalendar.min.css" rel="stylesheet" />
<script src="assets/libs/jquery.min.js"></script>
<script src="assets/libs/moment.min.js"></script>
<script src="assets/libs/fullcalendar.min.js"></script>
<script src="assets/libs/angular.min.js"></script>

<script src="app/data/fortnights.js"></script>
<script src="app/data/raids.js"></script>
<script src="app/data/specials.js"></script>

<script src="app/calEvents/fortnightEvents.js"></script>
<script src="app/calEvents/raidEvents.js"></script>
<script src="app/calEvents/specialEvents.js"></script>

<script>
    $(document).ready(function() {
        function createFortnightEvent(e) {
            var res = {};

            var id = e['id'];
            var fn = fortnights[id];

            res['id'] = id;
            res['title'] = '『FN』\n' + fn['name'];
            res['thumb'] = fn['thumb'];
            res['type'] = 'fortnight';

            res['start'] = e['start'];
            res['end'] = e['end'];

            var opacity = e['is_replay'] ? 0.3 : 0.6;
            res['color'] = 'rgba(255, 0, 0, ' + opacity + ')';
            res['textColor'] = 'black';

            return res;
        }

        function createRaidEvent(e) {
            var res = {};

            var id = e['id'];
            var rd = raids[id];

            res['id'] = id;
            res['title'] = '『Raid』\n' + rd['name'];
            res['thumb'] = rd['thumb'];
            res['type'] = 'raid';

            res['start'] = e['start'];

            res['color'] = 'rgba(60, 179, 113, 0.6)';
            res['textColor'] = 'black';

            return res;
        }

        function createSpecialEvent(e) {
            var res = {};

            var id = e['id'];
            var se = specials[id];

            res['id'] = id;
            res['title'] = '『Event』\n' + se['name'];
            res['thumb'] = se['thumb'];
            res['type'] = 'event';

            res['start'] = e['start'];
            res['end'] = e['end'];

            res['color'] = 'rgba(30, 144, 255, 0.6)';
            res['textColor'] = 'black';

            return res;
        }

        var eventArray = [];

        fortnightEvents.forEach(function(e) {
            eventArray.push(createFortnightEvent(e));
        });

        raidEvents.forEach(function(e) {
            eventArray.push(createRaidEvent(e));
        });

        specialEvents.forEach(function(e) {
            eventArray.push(createSpecialEvent(e));
        });

        $('#calendar').fullCalendar({
            aspectRatio: 0.65,
            events: eventArray,
            eventRender: function(event, element, calEvent) {
                var imgSrc = '';

                if (event.type == 'event')
                    imgSrc = 'assets/img/' + event.thumb + '.png';
                else
                    imgSrc = 'https://onepiece-treasurecruise.com/wp-content/uploads/f' + event.thumb + '.png';

                element.find('.fc-title').before(
                    '<img src="' + imgSrc + '" height="30" width="30" style="float: left;" />'
                );
            }
        });
    });
</script>

<style>
    body {
        margin: 40px 10px;
        padding: 0;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 15px;
    }

    #calendar {
        width: 1000px;
        margin: 0 auto;
    }

    .fc-title {
        padding-left: 10px;
        -webkit-box-decoration-break: clone;
        box-decoration-break: clone;
    }
</style>

<body>
    <div id="calendar"></div>
</body>
</html>
