<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Global OPTC Calendar</title>

    <link href="favicon.ico" rel="shortcut icon" />

    <link href="assets/css/fullcalendar.min.css" rel="stylesheet" />
    <script src="assets/libs/jquery.min.js"></script>
    <script src="assets/libs/moment.min.js"></script>
    <script src="assets/libs/fullcalendar.min.js"></script>
    <script src="assets/libs/angular.min.js"></script>

    <script src="app/data/fortnights.js"></script>
    <script src="app/data/raids.js"></script>
    <script src="app/data/specials_bg.js"></script>

    <script src="app/calEvents/fortnightEvents.js"></script>
    <script src="app/calEvents/raidEvents.js"></script>
    <script src="app/calEvents/specialBgEvents.js"></script>

    <script>
        $(document).ready(function() {
            function createFortnightEvent(e) {
                var res = {};

                var id = e['id'];
                var fn = fortnights[id];

                res['id'] = id;

                var title = '『FN』';

                if (e['has_ranking'])
                    title += ' ★Rank';

                title += '\n' + fn['name'];

                res['title'] = title;

                res['thumb'] = fn['thumb'];
                res['type'] = 'fortnight';

                res['start'] = e['start'];
                res['end'] = e['end'];

                var opacity = e['is_replay'] ? 0.3 : 0.6;
                res['color'] = 'rgba(255, 0, 0, ' + opacity + ')';
                res['textColor'] = 'black';

                return res;
            }

            function createRaidEvent(e) {
                var res = {};

                var id = e['id'];
                var rd = raids[id];

                res['id'] = id;

                var title = '『RD』';

                if (e['ambush'] != null)
                    res['ambush'] = e['ambush'];

                title += '\n' + rd['name'];

                res['title'] = title;
                res['thumb'] = rd['thumb'];
                res['type'] = 'raid';

                res['start'] = e['start'];
                if (e['end'] != '')
                    res['end'] = e['end'];

                res['color'] = 'rgba(60, 179, 113, 0.6)';
                res['textColor'] = 'black';

                return res;
            }

            function createSpecialBgEvent(e) {
                var res = {};

                var id = e['id'];
                var sbge = specials_bg[id];

                res['thumb'] = sbge['thumb'];
                res['type'] = 'event';

                res['start'] = e['start'];
                res['end'] = e['end'];

                res['color'] = 'rgba(0, 0, 0, 0)';
                res['rendering'] = 'background';

                return res;
            }

            var eventArray = [];

            fortnightEvents.forEach(function(e) {
                eventArray.push(createFortnightEvent(e));
            });

            raidEvents.forEach(function(e) {
                eventArray.push(createRaidEvent(e));
            });

            specialBgEvents.forEach(function(e) {
                eventArray.push(createSpecialBgEvent(e));
            });

            // Coliseums
            var coliseums = {
                'thumb': 'coliseum',
                'type': 'event',
                'color': 'rgba(0, 0, 0, 0)',
                'rendering': 'background',
                'permaStart': '2017-02-28',
                'dow': [3, 5, 6]
            }

            // Permanent Mihawk
            var mihawk = {
                'thumb': 'mihawk',
                'type': 'event',
                'color': 'rgba(0, 0, 0, 0)',
                'rendering': 'background',
                'permaStart': '2017-06-08',
                'dow': [5, 6]
            }

            eventArray.push(coliseums);
            eventArray.push(mihawk);

            $('#calendar').fullCalendar({
                aspectRatio: 0.55,
                events: eventArray,
                eventRender: function(event, element) {
                    if (event.type != 'event') {
                        var imgSrc = 'https://onepiece-treasurecruise.com/wp-content/uploads/f' + event.thumb + '.png';

                        element.find('.fc-title').before(
                            '<img src="' + imgSrc + '" height="30" width="30" style="float: left;" />'
                        );
                    } else {
                        element.closest('.fc-bgevent').css('background-image', 'url("assets/img/' + event.thumb + '.png")');
                    }

                    if (event.type == 'raid' && event.ambush != null) {
                        var imgSrc = 'https://onepiece-treasurecruise.com/wp-content/uploads/f' + event.ambush + '.png';

                        element.find('.fc-title').before(
                            '<img src="' + imgSrc + '" height="30" width="30" style="float: right;" />'
                        );
                    }

                    if (event.permaStart != null) {
                        return event.start.isAfter(event.permaStart);
                    }
                },
                eventOrder: 'id'
            });
        });
    </script>

    <style>
        body {
            margin: 40px 10px;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 15px;
        }

        #credit {
            width: 100%;
            text-align: center;
        }

        #calendar {
            width: 1052.1px;  /* 150px per cell, with 2.1px of lines */
            margin: 0 auto;
        }

        .fc-title {
            padding-left: 10px;
            -webkit-box-decoration-break: clone;
            box-decoration-break: clone;
        }

        .fc-bgevent {
            opacity: 0.75;
        }
    </style>
</head>

<body>
    <div id="calendar"></div>

    <br />

    <div id="credit">
        Calendar by <a href="https://www.reddit.com/u/zl1814">u/zl1814</a>, background images provided by <a href="https://www.reddit.com/u/qblcookie">u/qblcookie</a>
        <br />
        This site does not own any of the images. All images are owned by Eiichiro Oda/Shueisha, Toei Animation, and Bandai Namco.
    </div>
</body>
</html>
